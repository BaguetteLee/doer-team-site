<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>任务接单平台·团队资料设置</title>
  <!-- 依赖（与 doer 团队端保持一致） -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet"/>
  <style>
    :root {
      --primary: #0d6efd;
      --primary-light: #e8f0fe;
      --border: #e2e8f0;
      --text: #2d3748;
      --muted: #6b7280;
      --white: #fff;
      --bg: #f5f6f8;
    }
    body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }

    /* ===== 侧边栏 / 顶部栏骨架（严格沿用 doer-dashboard） ===== */
    .sidebar {
      background-color: var(--white); color: #4a5568; height: 100vh; position: fixed; left: 0; top: 0; width: 250px;
      padding-top: 60px; box-shadow: 2px 0 10px rgba(0, 0, 0, 0.05); border-right: 1px solid var(--border); z-index: 1000; overflow-y: auto;
    }
    .sidebar .nav-link { color: #4a5568; padding: 0.8rem 1rem; margin: 0.1rem 0.5rem; border-radius: 6px; transition: all 0.2s; display:flex; align-items:center; }
    .sidebar .nav-link:hover, .sidebar .nav-link.active { color: var(--primary); background-color: var(--primary-light); }
    .sidebar .nav-link i { margin-right: 10px; color: #718096; }
    .sidebar .nav-link.active i, .sidebar .nav-link:hover i { color: var(--primary); }
    .main-content { margin-left: 250px; padding: 20px; padding-top: 80px; transition: margin-left 0.3s; }
    .navbar {
      background-color: var(--white); box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05); border-bottom: 1px solid var(--border);
      position: fixed; top: 0; left: 0; right: 0; z-index: 1030; padding-left: 250px; transition: padding-left 0.3s;
    }
    .navbar-brand { color: var(--primary); font-weight: 700; }
    .dropdown-menu { border-radius: 8px; box-shadow: 0 10px 15px rgba(0,0,0,.08); border: 1px solid var(--border); }
    .dropdown-item { padding:.5rem 1rem; border-radius:4px; margin:.1rem .5rem; width:auto; }

    /* 侧边栏分组点（与 doer-dashboard 一致） */
    #doer-nav .nav-section{ margin:.75rem .25rem .25rem; font-size:.8125rem; color:#6c757d; display:flex; align-items:center; gap:.5rem; }
    #doer-nav .nav-section .dot{ width:10px; height:10px; border-radius:2px; display:inline-block; }
    #doer-nav .dot--platform{ background:#0d6efd; }
    #doer-nav .dot--task{ background:#20c997; }
    #doer-nav .dot--user{ background:#fd7e14; }
    #doer-nav .dot--settings{ background:#6f42c1; }
    :root{ --sidebar-active-bg: rgba(13,110,253,.10); --sidebar-active:#0d6efd; }
    .sidebar .nav-link.active{ color:var(--sidebar-active); background:var(--sidebar-active-bg); font-weight:600; }

    /* ===== 页面自身样式（借鉴 pub-team-team-profile，但切换为接单端语义；中文注释） ===== */
    .card{ border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,.04); border: none; }
    .avatar{ width:76px; height:76px; border-radius:50%; background:#e9efff; display:flex; align-items:center; justify-content:center; color:#0d6efd; font-size:2rem; }
    .kv{ display:flex; gap:8px; align-items:center; color:var(--muted); }
    .kv .v{ color:#0d6efd; font-weight:700; }
    .info-label{ min-width:110px; color:#6b7280; }
    .chip{ display:inline-flex; align-items:center; gap:6px; padding:2px 8px; border-radius:999px; background:#f3f4f6; font-size:12px; margin:2px 6px 2px 0; }
    .badge-on{ background:#e8f5e9; color:#2e7d32; }
    .badge-off{ background:#fde8ea; color:#c62828; }

    /* Toast 容器 */
    #toastBox{ position: fixed; right: 16px; bottom: 16px; z-index: 2000; }

    /* 响应式（沿用 doer-dashboard） */
    @media (max-width: 992px) {
      .sidebar { width: 80px; padding-top: 70px; }
      .sidebar .nav-link span { display: none; }
      .sidebar .nav-link i { margin-right: 0; font-size: 1.2rem; }
      .main-content { margin-left: 80px; }
      .navbar { padding-left: 80px; }
    }
    @media (max-width: 768px) {
      .sidebar { transform: translateX(-100%); width: 250px; }
      .sidebar.show { transform: translateX(0); }
      .main-content { margin-left: 0; }
      .navbar { padding-left: 15px; }
      .navbar-toggler { display: block; }
    }
    .navbar-toggler { display: none; border: none; font-size: 1.25rem; }
    .navbar-toggler:focus { box-shadow: none; }
  </style>
<link rel="stylesheet" href="p1-unify.css"/>
<link rel="stylesheet" href="p2-unify.css"/>
</head>
<body>
  <!-- 顶部状态栏（严格按 doer-dashboard） -->
  <nav class="navbar navbar-expand-lg navbar-light">
    <div class="container-fluid">
      <button class="navbar-toggler" id="sidebarToggle" type="button">
        <span class="navbar-toggler-icon"></span>
      </button>
      <a class="navbar-brand" href="#"><strong><i class="bi bi-lightning-charge me-2"></i>任务接单管理平台</strong></a>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto me-5">
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="bi bi-bell"></i>
              <span class="badge bg-danger">3</span>
            </a>
            <ul class="dropdown-menu dropdown-menu-end">
              <li><a class="dropdown-item" href="#"><i class="bi bi-plus-circle me-2"></i>5个新任务可接单</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-cash-coin me-2"></i>2个提现申请待处理</a></li>
              <li><hr class="dropdown-divider"/></li>
              <!-- 统一“查看所有通知”入口 -->
              <li><a class="dropdown-item" href="#" id="viewAllNotifications"><i class="bi bi-list-ul me-2"></i>查看所有通知</a></li>
            </ul>
          </li>
          <li class="nav-item dropdown ms-2">
            <a class="nav-link dropdown-toggle d-flex align-items-center" id="userDropdown" role="button" data-bs-toggle="dropdown">
              <i class="bi bi-person-circle me-2"></i> 接单管理员
            </a>
            <ul class="dropdown-menu dropdown-menu-end">
              <li><a class="dropdown-item" href="#"><i class="bi bi-person me-2"></i>个人资料</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-gear me-2"></i>设置</a></li>
              <li><hr class="dropdown-divider"/></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-box-arrow-right me-2"></i>退出</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- 侧边栏（严格按 doer-dashboard，active 在本页） -->
  <div class="sidebar" id="doer-nav">
    <div class="position-sticky">
      <ul class="nav flex-column">
        <!-- 平台 -->
        <li class="nav-section"><span class="dot dot--platform"></span><span>平台</span></li>
        <li class="nav-item"><a class="nav-link" href="doer-team-analytics-dashboard.html"><i class="bi bi-speedometer2 me-2"></i> <span>平台总仪表盘</span></a></li>
        <li><a class="nav-link" href="doer-team-finance-platform-fund-flow.html"><i class="bi bi-cash-coin me-2"></i> <span>平台资金流水</span></a></li>
        <!-- 任务 -->
        <li class="nav-section"><span class="dot dot--task"></span><span>任务</span></li>
        <li><a class="nav-link" href="doer-team-orders-situation.html"><i class="bi bi-cart-check me-2"></i> <span>任务接单情况</span></a></li>
        <li><a class="nav-link" href="doer-team-tasks-completion.html"><i class="bi bi-check2-circle me-2"></i> <span>任务完成情况</span></a></li>
        <li><a class="nav-link" href="doer-team-tasks-list.html"><i class="bi bi-list-task me-2"></i> <span>可接任务列表</span></a></li>
        <!-- 用户 -->
        <li class="nav-section"><span class="dot dot--user"></span><span>用户</span></li>
        <li><a class="nav-link" href="doer-team-users-list.html"><i class="bi bi-people me-2"></i> <span>平台用户列表</span></a></li>
        <li><a class="nav-link" href="doer-team-finance-withdrawal-list.html"><i class="bi bi-bank me-2"></i> <span>用户提现列表</span></a></li>
        <li><a class="nav-link" href="doer-team-finance-user-fund-flow.html"><i class="bi bi-journal-text me-2"></i> <span>用户资金流水</span></a></li>
        <!-- 设置 -->
        <li class="nav-section"><span class="dot dot--settings"></span><span>设置</span></li>
        <li><a class="nav-link" href="doer-team-settings-categories.html"><i class="bi bi-sliders me-2"></i> <span>业务分类概览</span></a></li>
        <li><a class="nav-link" href="doer-team-system-api-monitoring.html"><i class="bi bi-activity me-2"></i> <span>接口管理监控</span></a></li>
        <li><a class="nav-link" href="doer-team-finance-payment-account.html"><i class="bi bi-credit-card me-2"></i> <span>支付账户设置</span></a></li>
        <li><a class="nav-link" href="doer-team-account-management.html"><i class="bi bi-person-gear me-2"></i> <span>账号管理设置</span></a></li>
        <li><a class="nav-link active" href="doer-team-team-profile.html"><i class="bi bi-building-gear me-2"></i> <span>团队资料设置</span></a></li>
      </ul>
    </div>
  </div>

  <!-- 主内容区（内容按 pub 团队“团队资料设置”设计，但调为接单端视角） -->
  <main class="main-content">
    <div class="container-fluid">
      <!-- 抬头 -->
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
          <h5 class="mb-1">团队资料（接单端）</h5>
          <div class="text-muted small">保留团队身份、认证资料与合约信息；不包含财务/API模块（这些已在其他页面呈现）。</div>
        </div>
        <div class="d-flex gap-2">
          <button class="btn btn-outline-secondary btn-sm" id="btnEditProfile"><i class="bi bi-pencil me-1"></i>编辑资料</button>
          <button class="btn btn-outline-primary btn-sm" id="btnEditContract"><i class="bi bi-file-earmark-text me-1"></i>合约信息</button>
          <button class="btn btn-primary btn-sm" id="btnEditCert"><i class="bi bi-patch-check me-1"></i>认证资料</button>
        </div>
      </div>

      <!-- 顶部信息卡片 -->
      <div class="card mb-3">
        <div class="card-body d-flex align-items-center gap-3">
          <div class="avatar" id="avatar">T</div>
          <div class="flex-grow-1">
            <div class="h6 mb-1"><span id="teamName">—</span> <span class="badge text-bg-light" id="teamType">—</span></div>
            <div class="kv"><i class="bi bi-geo-alt"></i><span>所在地区</span><span class="v" id="teamLocation">—</span></div>
            <div class="kv"><i class="bi bi-tags"></i><span>接单类目</span><span class="v" id="teamTags">—</span></div>
          </div>
          <div class="text-end">
            <div class="small text-muted">认证状态</div>
            <div id="teamVerify"><span class="badge badge-off">未认证</span></div>
          </div>
        </div>
      </div>

      <!-- 基本信息 -->
      <div class="card mb-3">
        <div class="card-header bg-white"><i class="bi bi-info-circle me-1"></i> 基本信息</div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-12 col-md-6 d-flex"><div class="info-label">团队简称</div><div id="teamShort">—</div></div>
            <div class="col-12 col-md-6 d-flex"><div class="info-label">团队ID</div><div class="text-mono" id="teamId">—</div></div>
            <div class="col-12 d-flex"><div class="info-label">办公地址</div><div id="teamAddr">—</div></div>
            <div class="col-12 d-flex"><div class="info-label">对接联系人</div><div id="teamContact">—</div></div>
            <div class="col-12 d-flex"><div class="info-label">联系方式</div><div id="teamContactWay">—</div></div>
            <div class="col-12 d-flex"><div class="info-label">团队简介</div><div id="teamDesc">—</div></div>
          </div>
        </div>
      </div>

      <!-- 认证资料 -->
      <div class="card mb-3">
        <div class="card-header bg-white"><i class="bi bi-patch-check me-1"></i> 认证资料</div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-12 col-md-6">
              <div class="border rounded p-3">
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <div class="fw-semibold">营业执照</div>
                  <span class="badge text-bg-success" id="licStatus">已验证</span>
                </div>
                <div class="text-muted small">文件：<span id="licFile">—</span></div>
                <div class="text-muted small">上传时间：<span id="licTime">—</span></div>
              </div>
            </div>
            <div class="col-12 col-md-6">
              <div class="border rounded p-3">
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <div class="fw-semibold">法人身份证</div>
                  <span class="badge text-bg-success" id="idStatus">已验证</span>
                </div>
                <div class="text-muted small">文件：<span id="idFile">—</span></div>
                <div class="text-muted small">上传时间：<span id="idTime">—</span></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 合约信息 -->
      <div class="card mb-3">
        <div class="card-header bg-white"><i class="bi bi-file-earmark-text me-1"></i> 合约信息</div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-12 col-md-4 d-flex"><div class="info-label">合约编号</div><div id="ctrNo">—</div></div>
            <div class="col-12 col-md-4 d-flex"><div class="info-label">签约时间</div><div id="ctrSign">—</div></div>
            <div class="col-12 col-md-4 d-flex"><div class="info-label">合约期限</div><div id="ctrTerm">—</div></div>
            <div class="col-12 col-md-4 d-flex"><div class="info-label">生效日期</div><div id="ctrStart">—</div></div>
            <div class="col-12 col-md-4 d-flex"><div class="info-label">到期日期</div><div id="ctrEnd">—</div></div>
            <div class="col-12 col-md-4 d-flex"><div class="info-label">当前状态</div><div id="ctrStatus"><span class="badge text-bg-success">生效中</span></div></div>
            <div class="col-12 d-flex"><div class="info-label">备注</div><div id="ctrNote">—</div></div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Toast 容器 -->
  <div id="toastBox"></div>

  <!-- 通知模态框（统一实现） -->
  <div class="modal fade" id="modalAllNotifications" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">全部通知</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="关闭"></button>
        </div>
        <div class="modal-body">
          <ul class="list-group">
            <li class="list-group-item d-flex justify-content-between align-items-start">
              <div class="ms-2 me-auto">
                <div class="fw-normal">提现申请 #TW-20250915-001 已通过，请查看打款记录。</div>
                <small class="text-muted">2 分钟前</small>
              </div>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-start">
              <div class="ms-2 me-auto">
                <div class="fw-normal">任务 #D250916-112 进入异议处理中。</div>
                <small class="text-muted">30 分钟前</small>
              </div>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-start">
              <div class="ms-2 me-auto">
                <div class="fw-normal">系统例行备份完成，共 2 份增量。</div>
                <small class="text-muted">今天 03:12</small>
              </div>
            </li>
          </ul>
        </div>
        <div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button></div>
      </div>
    </div>
  </div>

  <!-- 依赖脚本 -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    /* ========== 工具函数（中文注释） ========== */
    const today = new Date('2025-09-18T12:00:00'); // 固定演示时间
    const fmtTime = (d)=> new Date(d).toISOString().slice(0,19).replace('T',' ');
    function toast(msg,type='success'){
      const w = document.createElement('div');
      w.className = 'toast align-items-center text-bg-' + (type==='success'?'success':type==='danger'?'danger':'secondary') + ' border-0 show';
      w.role = 'alert'; w.ariaLive = 'assertive'; w.ariaAtomic = 'true';
      w.style.marginTop = '8px';
      w.innerHTML = '<div class="d-flex"><div class="toast-body">'+msg+'</div><button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button></div>';
      document.getElementById('toastBox').appendChild(w);
      setTimeout(()=> w.remove(), 2600);
    }

    /* ========== 顶/侧行为（与 doer-dashboard 一致） ========== */
    document.getElementById('sidebarToggle').addEventListener('click', function(){
      document.querySelector('.sidebar').classList.toggle('show');
    });
    // “查看所有通知”入口统一弹模态
    document.addEventListener('DOMContentLoaded', function(){
      function bindOpen(id){
        var el = document.getElementById(id);
        if(!el) return;
        el.addEventListener('click', function(e){
          e.preventDefault();
          var mEl = document.getElementById('modalAllNotifications');
          if(mEl){
            var m = bootstrap.Modal.getOrCreateInstance(mEl);
            m.show();
          }
        });
      }
      bindOpen('viewAllNotifications');
    });

    /* ========== 本地持久化键（doer 端前缀，避免与 pub 端冲突） ========== */
    const KEY_TEAM = 'doer_team_profile_v1';
    const KEY_CERT = 'doer_team_cert_v1';
    const KEY_CTR  = 'doer_team_contract_v1';

    function loadTeam(){
      return JSON.parse(localStorage.getItem(KEY_TEAM)||'null') || {
        id: 'DOER-TEAM-202409-001',
        name: '承信执行团队',
        short: '承信',
        type: '接单执行团队',
        location: '浙江 · 杭州',
        address: '杭州市西湖区万塘路 18 号',
        contact: '李主管 / 业务对接',
        contactWay: '13800008888',
        tags: ['短视频互动','内容共创','拉新体验'],
        desc: '专注执行侧的质量与规模化交付，具备成熟风控体系与复盘机制。',
        verified: true
      };
    }
    function saveTeam(d){ localStorage.setItem(KEY_TEAM, JSON.stringify(d)); }

    function loadCert(){
      return JSON.parse(localStorage.getItem(KEY_CERT)||'null') || {
        licFile: '营业执照.pdf',
        licTime: fmtTime('2025-06-15T10:00:00'),
        idFile: '法人身份证.jpg',
        idTime: fmtTime('2025-06-15T10:05:00'),
        verified: true
      };
    }
    function saveCert(d){ localStorage.setItem(KEY_CERT, JSON.stringify(d)); }

    function loadCtr(){
      return JSON.parse(localStorage.getItem(KEY_CTR)||'null') || {
        no: 'CON-DOER-202406-001',
        sign: '2024-06-20',
        term: '2年',
        start: '2024-06-20',
        end: '2026-06-19',
        status: '生效中',
        note: '接单平台服务协议。'
      };
    }
    function saveCtr(d){ localStorage.setItem(KEY_CTR, JSON.stringify(d)); }

    /* ========== 初始化渲染 ========== */
    let team = loadTeam();
    let cert = loadCert();
    let ctr  = loadCtr();

    function render(){
      // 头像首字
      document.getElementById('avatar').textContent = team.short? team.short[0] : (team.name? team.name[0] : 'T');
      // 顶卡
      document.getElementById('teamName').textContent = team.name||'—';
      document.getElementById('teamType').textContent = team.type||'—';
      document.getElementById('teamLocation').textContent = team.location||'—';
      document.getElementById('teamTags').innerHTML = (team.tags&&team.tags.length)? team.tags.map(t=>`<span class="chip"><i class="bi bi-tag"></i>${t}</span>`).join('') : '—';
      document.getElementById('teamVerify').innerHTML = team.verified? '<span class="badge badge-on">已认证</span>' : '<span class="badge badge-off">未认证</span>';
      // 基本信息
      document.getElementById('teamShort').textContent = team.short||'—';
      document.getElementById('teamId').textContent = team.id||'—';
      document.getElementById('teamAddr').textContent = team.address||'—';
      document.getElementById('teamContact').textContent = team.contact||'—';
      document.getElementById('teamContactWay').textContent = team.contactWay||'—';
      document.getElementById('teamDesc').textContent = team.desc||'—';
      // 认证
      document.getElementById('licFile').textContent = cert.licFile||'—';
      document.getElementById('licTime').textContent = cert.licTime||'—';
      document.getElementById('idFile').textContent = cert.idFile||'—';
      document.getElementById('idTime').textContent = cert.idTime||'—';
      document.getElementById('licStatus').className = 'badge ' + (cert.verified? 'text-bg-success':'text-bg-secondary');
      document.getElementById('idStatus').className  = 'badge ' + (cert.verified? 'text-bg-success':'text-bg-secondary');
      // 合约
      document.getElementById('ctrNo').textContent = ctr.no||'—';
      document.getElementById('ctrSign').textContent = ctr.sign||'—';
      document.getElementById('ctrTerm').textContent = ctr.term||'—';
      document.getElementById('ctrStart').textContent = ctr.start||'—';
      document.getElementById('ctrEnd').textContent = ctr.end||'—';
      document.getElementById('ctrStatus').innerHTML = `<span class="badge ${ctr.status==='生效中'?'text-bg-success':ctr.status==='即将到期'?'text-bg-warning':'text-bg-secondary'}">${ctr.status||'—'}</span>`;
      document.getElementById('ctrNote').textContent = ctr.note||'—';
    }
    render();

    /* ========== 交互：编辑资料/认证/合约 ========== */
    // 资料 Modal
    function openProfileModal(){
      document.getElementById('fTeamName').value = team.name||'';
      document.getElementById('fShort').value    = team.short||'';
      document.getElementById('fType').value     = team.type||'接单执行团队';
      document.getElementById('fLocation').value = team.location||'';
      document.getElementById('fAddr').value     = team.address||'';
      document.getElementById('fContact').value  = team.contact||'';
      document.getElementById('fContactWay').value = team.contactWay||'';
      document.getElementById('fTags').value     = (team.tags||[]).join(', ');
      document.getElementById('fDesc').value     = team.desc||'';
      new bootstrap.Modal('#profileModal').show();
    }
    document.getElementById('btnEditProfile').addEventListener('click', openProfileModal);

    function saveProfile(){
      const next = {
        ...team,
        name: document.getElementById('fTeamName').value.trim(),
        short: document.getElementById('fShort').value.trim(),
        type: document.getElementById('fType').value,
        location: document.getElementById('fLocation').value.trim(),
        address: document.getElementById('fAddr').value.trim(),
        contact: document.getElementById('fContact').value.trim(),
        contactWay: document.getElementById('fContactWay').value.trim(),
        tags: (document.getElementById('fTags').value||'').split(',').map(s=>s.trim()).filter(Boolean),
        desc: document.getElementById('fDesc').value.trim()
      };
      if(!next.name){ toast('请填写团队名称','danger'); return; }
      if(!next.short){ toast('请填写团队简称','danger'); return; }
      team = next; saveTeam(team); render();
      bootstrap.Modal.getInstance(document.getElementById('profileModal')).hide();
      toast('团队资料已保存');
    }

    // 认证 Modal
    function openCertModal(){
      document.getElementById('fLicFile').value = cert.licFile||'';
      document.getElementById('fIdFile').value  = cert.idFile||'';
      document.getElementById('fVerified').checked = !!(team.verified && cert.verified);
      new bootstrap.Modal('#certModal').show();
    }
    function saveCert(){
      const v = document.getElementById('fVerified').checked;
      cert.licFile = document.getElementById('fLicFile').value.trim() || cert.licFile;
      cert.idFile  = document.getElementById('fIdFile').value.trim()  || cert.idFile;
      cert.licTime = fmtTime(today);
      cert.idTime  = fmtTime(today);
      cert.verified = v;
      team.verified = v;
      saveCert(cert); saveTeam(team); render();
      bootstrap.Modal.getInstance(document.getElementById('certModal')).hide();
      toast('认证资料已更新');
    }

    // 合约 Modal
    function openContractModal(){
      document.getElementById('fCtrNo').value   = ctr.no||'';
      document.getElementById('fCtrSign').value = ctr.sign||'';
      document.getElementById('fCtrTerm').value = ctr.term||'';
      document.getElementById('fCtrStart').value= ctr.start||'';
      document.getElementById('fCtrEnd').value  = ctr.end||'';
      document.getElementById('fCtrStatus').value= ctr.status||'生效中';
      document.getElementById('fCtrNote').value = ctr.note||'';
      new bootstrap.Modal('#contractModal').show();
    }
    function saveContract(){
      ctr = {
        no: document.getElementById('fCtrNo').value.trim(),
        sign: document.getElementById('fCtrSign').value,
        term: document.getElementById('fCtrTerm').value.trim(),
        start: document.getElementById('fCtrStart').value,
        end: document.getElementById('fCtrEnd').value,
        status: document.getElementById('fCtrStatus').value,
        note: document.getElementById('fCtrNote').value.trim()
      };
      saveCtr(ctr); render();
      bootstrap.Modal.getInstance(document.getElementById('contractModal')).hide();
      toast('合约信息已保存');
    }

    // 绑定按钮
    document.getElementById('btnEditCert').addEventListener('click', openCertModal);
    document.getElementById('btnEditContract').addEventListener('click', openContractModal);

    // 统一绑定保存按钮（避免重复选择器）
    document.addEventListener('click', function(e){
      const id = e.target.id;
      if(id==='btnSaveProfile'){ saveProfile(); }
      if(id==='btnSaveCert'){ saveCert(); }
      if(id==='btnSaveContract'){ saveContract(); }
    });
  </script>

  <!-- ========== 编辑资料 Modal ========== -->
  <div class="modal fade" id="profileModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header"><h5 class="modal-title">编辑团队资料</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
        <div class="modal-body">
          <form class="row g-3" id="formProfile">
            <div class="col-12 col-md-6">
              <label class="form-label">团队名称</label>
              <input class="form-control" id="fTeamName" placeholder="如：承信执行团队"/>
            </div>
            <div class="col-12 col-md-3">
              <label class="form-label">团队简称</label>
              <input class="form-control" id="fShort" placeholder="如：承信"/>
            </div>
            <div class="col-12 col-md-3">
              <label class="form-label">团队类型</label>
              <select class="form-select" id="fType">
                <option>接单执行团队</option>
                <option>联合体/战略合作</option>
              </select>
            </div>
            <div class="col-12 col-md-6">
              <label class="form-label">所在地区</label>
              <input class="form-control" id="fLocation" placeholder="省市区"/>
            </div>
            <div class="col-12 col-md-6">
              <label class="form-label">办公地址</label>
              <input class="form-control" id="fAddr" placeholder="详细地址"/>
            </div>
            <div class="col-12 col-md-6">
              <label class="form-label">对接联系人</label>
              <input class="form-control" id="fContact" placeholder="姓名与职位（可选）"/>
            </div>
            <div class="col-12 col-md-6">
              <label class="form-label">联系方式</label>
              <input class="form-control" id="fContactWay" placeholder="电话（可留座机或手机号）"/>
            </div>
            <div class="col-12">
              <label class="form-label">接单类目（逗号分隔）</label>
              <input class="form-control" id="fTags" placeholder="如：短视频互动, 内容共创, 拉新体验"/>
            </div>
            <div class="col-12">
              <label class="form-label">团队简介</label>
              <textarea class="form-control" id="fDesc" rows="3"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-light" data-bs-dismiss="modal">取消</button>
          <button class="btn btn-primary" id="btnSaveProfile">保存</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ========== 编辑认证 Modal ========== -->
  <div class="modal fade" id="certModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header"><h5 class="modal-title">认证资料</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
        <div class="modal-body">
          <form class="row g-3" id="formCert">
            <div class="col-12">
              <label class="form-label">营业执照文件名</label>
              <input class="form-control" id="fLicFile" placeholder="如：营业执照.pdf"/>
            </div>
            <div class="col-12">
              <label class="form-label">法人身份证文件名</label>
              <input class="form-control" id="fIdFile" placeholder="如：法人身份证.jpg"/>
            </div>
            <div class="col-12">
              <div class="form-check">
                <input class="form-check-input" id="fVerified" type="checkbox"/>
                <label class="form-check-label" for="fVerified">资料已验证</label>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-light" data-bs-dismiss="modal">取消</button>
          <button class="btn btn-primary" id="btnSaveCert">保存</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ========== 编辑合约 Modal ========== -->
  <div class="modal fade" id="contractModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header"><h5 class="modal-title">合约信息</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
        <div class="modal-body">
          <form class="row g-3" id="formContract">
            <div class="col-12 col-md-4">
              <label class="form-label">合约编号</label>
              <input class="form-control" id="fCtrNo" placeholder="如：CON-DOER-202406-001"/>
            </div>
            <div class="col-12 col-md-4">
              <label class="form-label">签约日期</label>
              <input class="form-control" id="fCtrSign" type="date"/>
            </div>
            <div class="col-12 col-md-4">
              <label class="form-label">合约期限</label>
              <input class="form-control" id="fCtrTerm" placeholder="如：2年"/>
            </div>
            <div class="col-12 col-md-4">
              <label class="form-label">生效日期</label>
              <input class="form-control" id="fCtrStart" type="date"/>
            </div>
            <div class="col-12 col-md-4">
              <label class="form-label">到期日期</label>
              <input class="form-control" id="fCtrEnd" type="date"/>
            </div>
            <div class="col-12 col-md-4">
              <label class="form-label">状态</label>
              <select class="form-select" id="fCtrStatus">
                <option value="生效中">生效中</option>
                <option value="即将到期">即将到期</option>
                <option value="已到期">已到期</option>
              </select>
            </div>
            <div class="col-12">
              <label class="form-label">备注</label>
              <textarea class="form-control" id="fCtrNote" rows="2"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-light" data-bs-dismiss="modal">取消</button>
          <button class="btn btn-primary" id="btnSaveContract">保存</button>
        </div>
      </div>
    </div>
  </div>
<script src="p1-unify.js"></script>
<script src="p2-unify.js"></script>
</body>
</html>
